<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OP_NET ‚Äî Wallet Copilot & DeFi Hub</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --btc: #f7931a;
    --opnet: #ff6b2b;
    --dark: #0a0a0f;
    --card: #111118;
    --card2: #15151e;
    --border: rgba(247,147,26,0.18);
    --glow: rgba(247,147,26,0.12);
    --text: #e8e8f0;
    --muted: #6b6b80;
    --green: #00d68f;
    --red: #ff4d6d;
    --moto: #8b5cf6;
    --cat: #f472b6;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  html { scroll-behavior: smooth; }
  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  /* Grid bg */
  body::before {
    content:'';
    position:fixed; inset:0; z-index:0;
    background-image: 
      linear-gradient(rgba(247,147,26,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(247,147,26,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }

  /* ‚îÄ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ‚îÄ */
  .topbar {
    position: sticky; top:0; z-index:100;
    display:flex; align-items:center; gap:16px;
    padding: 0 24px; height: 52px;
    background: rgba(10,10,15,0.92);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
  }
  .logo { font-size:17px; font-weight:800; letter-spacing:-0.5px; color:#fff; }
  .logo span { color: var(--btc); }
  .price-pill {
    display:flex; align-items:center; gap:6px;
    background: rgba(247,147,26,0.1);
    border: 1px solid var(--border);
    border-radius: 20px; padding: 3px 10px;
    font-family: 'Space Mono', monospace;
    font-size: 12px; color: var(--btc);
  }
  .price-pill .change { font-size:11px; }
  .change.up { color: var(--green); }
  .change.down { color: var(--red); }
  .topbar-links { display:flex; gap:2px; margin-left:auto; }
  .topbar-links a {
    padding: 5px 12px; border-radius:6px; font-size:12px; font-weight:600;
    color: var(--muted); text-decoration:none; transition:.15s;
  }
  .topbar-links a:hover { background:rgba(255,255,255,0.06); color:#fff; }
  .topbar-links a.active { color: var(--btc); }
  .connect-btn {
    padding: 6px 14px; border-radius:6px; font-size:12px; font-weight:700;
    background: var(--btc); color:#000; border:none; cursor:pointer;
    font-family: 'Syne', sans-serif; transition:.15s;
  }
  .connect-btn:hover { background:#ffa733; }

  /* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
  .page { position:relative; z-index:1; }
  .section { padding: 32px 24px; max-width: 1200px; margin: 0 auto; }
  .section-title {
    font-size:13px; font-weight:700; letter-spacing:2px; text-transform:uppercase;
    color: var(--muted); margin-bottom:16px;
    display:flex; align-items:center; gap:8px;
  }
  .section-title::after {
    content:''; flex:1; height:1px; background:var(--border);
  }

  /* ‚îÄ‚îÄ‚îÄ HERO ‚îÄ‚îÄ‚îÄ */
  .hero {
    padding: 60px 24px 40px;
    max-width: 1200px; margin: 0 auto;
    display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: center;
  }
  .hero-left h1 {
    font-size: clamp(32px, 5vw, 56px); font-weight: 800; line-height:1.05;
    letter-spacing: -2px;
  }
  .hero-left h1 em { font-style:normal; color: var(--btc); }
  .hero-left p { color: var(--muted); font-size:15px; margin-top:16px; line-height:1.6; }
  .hero-actions { display:flex; gap:10px; margin-top:24px; flex-wrap:wrap; }
  .btn-primary {
    padding: 10px 22px; background: var(--btc); color:#000; border:none;
    border-radius:8px; font-weight:700; font-size:14px; cursor:pointer;
    font-family:'Syne',sans-serif; transition:.15s; text-decoration:none; display:inline-block;
  }
  .btn-primary:hover { background:#ffa733; }
  .btn-ghost {
    padding: 10px 22px; background:transparent; color:var(--text);
    border: 1px solid var(--border); border-radius:8px; font-weight:600; font-size:14px;
    cursor:pointer; font-family:'Syne',sans-serif; transition:.15s; text-decoration:none; display:inline-block;
  }
  .btn-ghost:hover { border-color:var(--btc); color:var(--btc); }
  .hero-right { position:relative; }
  .stats-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .stat-card {
    background:var(--card); border:1px solid var(--border); border-radius:12px;
    padding:16px; position:relative; overflow:hidden;
  }
  .stat-card::before {
    content:''; position:absolute; top:0; left:0; right:0; height:2px;
    background: linear-gradient(90deg, var(--btc), transparent);
  }
  .stat-label { font-size:11px; color:var(--muted); font-weight:600; letter-spacing:1px; text-transform:uppercase; }
  .stat-val { font-size:22px; font-weight:800; margin-top:6px; color:#fff; font-family:'Space Mono',monospace; }
  .stat-sub { font-size:11px; color:var(--muted); margin-top:2px; }

  /* ‚îÄ‚îÄ‚îÄ CHART ‚îÄ‚îÄ‚îÄ */
  .chart-section { padding: 0 24px 32px; max-width:1200px; margin:0 auto; }
  .chart-card {
    background:var(--card); border:1px solid var(--border); border-radius:16px; padding:24px;
    position:relative; overflow:hidden;
  }
  .chart-card::before {
    content:''; position:absolute; top:0; left:0; right:0; height:3px;
    background: linear-gradient(90deg, var(--btc), var(--opnet), transparent);
  }
  .chart-header { display:flex; align-items:center; gap:16px; margin-bottom:20px; flex-wrap:wrap; }
  .chart-title { font-size:18px; font-weight:800; }
  .chart-price { font-family:'Space Mono',monospace; font-size:24px; font-weight:700; color:var(--btc); }
  .chart-change { font-size:13px; padding:3px 8px; border-radius:4px; font-weight:700; font-family:'Space Mono',monospace; }
  .chart-change.up { background:rgba(0,214,143,0.15); color:var(--green); }
  .chart-change.down { background:rgba(255,77,109,0.15); color:var(--red); }
  .chart-tabs { display:flex; gap:4px; margin-left:auto; }
  .chart-tab {
    padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600;
    background:transparent; border:1px solid var(--border); color:var(--muted);
    cursor:pointer; font-family:'Syne',sans-serif; transition:.12s;
  }
  .chart-tab.active, .chart-tab:hover { background:var(--btc); color:#000; border-color:var(--btc); }
  #btcChart { max-height:280px; }
  .chart-footer { display:flex; gap:24px; margin-top:16px; flex-wrap:wrap; }
  .chart-stat { font-size:12px; }
  .chart-stat span { color:var(--muted); margin-right:4px; }
  .chart-stat b { font-family:'Space Mono',monospace; }

  /* ‚îÄ‚îÄ‚îÄ ECOSYSTEM ‚îÄ‚îÄ‚îÄ */
  .eco-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:12px; }
  .eco-card {
    background:var(--card2); border:1px solid var(--border); border-radius:12px;
    padding:18px; text-decoration:none; color:var(--text);
    transition:.2s; position:relative; overflow:hidden; display:block;
  }
  .eco-card::before {
    content:''; position:absolute; inset:0; opacity:0; transition:.2s;
    background: radial-gradient(circle at 30% 30%, rgba(247,147,26,0.08), transparent 70%);
  }
  .eco-card:hover::before { opacity:1; }
  .eco-card:hover { border-color:rgba(247,147,26,0.4); transform:translateY(-2px); }
  .eco-icon { font-size:28px; margin-bottom:10px; }
  .eco-name { font-size:14px; font-weight:700; margin-bottom:4px; }
  .eco-desc { font-size:12px; color:var(--muted); line-height:1.5; }
  .eco-tag {
    display:inline-block; margin-top:8px;
    font-size:10px; font-weight:700; letter-spacing:1px; padding:2px 7px; border-radius:4px;
    background:rgba(247,147,26,0.12); color:var(--btc); text-transform:uppercase;
  }
  .eco-tag.moto { background:rgba(139,92,246,0.15); color:var(--moto); }
  .eco-tag.cat { background:rgba(244,114,182,0.15); color:var(--cat); }

  /* ‚îÄ‚îÄ‚îÄ WALLET COPILOT ‚îÄ‚îÄ‚îÄ */
  .tools-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .tool-card {
    background:var(--card); border:1px solid var(--border); border-radius:16px;
    padding:24px; position:relative; overflow:hidden;
  }
  .tool-card .tc-title { font-size:16px; font-weight:700; margin-bottom:4px; display:flex; align-items:center; gap:8px; }
  .tool-card .tc-sub { font-size:13px; color:var(--muted); margin-bottom:16px; }
  .input-row { display:flex; gap:8px; }
  .addr-input {
    flex:1; background:rgba(255,255,255,0.05); border:1px solid var(--border);
    border-radius:8px; padding:10px 14px; color:#fff; font-size:13px; outline:none;
    font-family:'Space Mono',monospace; transition:.15s;
  }
  .addr-input:focus { border-color:var(--btc); background:rgba(247,147,26,0.05); }
  .addr-input::placeholder { color:var(--muted); }
  .analyze-btn {
    padding:10px 16px; background:var(--btc); color:#000; border:none;
    border-radius:8px; font-weight:700; font-size:13px; cursor:pointer;
    font-family:'Syne',sans-serif; white-space:nowrap; transition:.15s;
  }
  .analyze-btn:hover { background:#ffa733; }
  .result-box {
    margin-top:14px; background:rgba(0,0,0,0.3); border:1px solid var(--border);
    border-radius:8px; padding:14px; min-height:80px;
    font-size:13px; color:var(--muted); font-family:'Space Mono',monospace;
    line-height:1.6;
  }
  .result-box.loading::after {
    content:'Analyzing...'; animation: blink 1s infinite;
  }
  @keyframes blink { 50% { opacity:0.3; } }
  .ai-bubble {
    background:rgba(247,147,26,0.08); border:1px solid var(--border);
    border-radius:10px; padding:12px 14px; margin-top:12px; font-size:13px;
    line-height:1.6;
  }
  .ai-bubble .ai-tag { color:var(--btc); font-weight:700; font-size:11px; margin-bottom:6px; text-transform:uppercase; letter-spacing:1px; }

  /* ‚îÄ‚îÄ‚îÄ GAME ‚îÄ‚îÄ‚îÄ */
  .game-card {
    background:var(--card); border:1px solid var(--border); border-radius:16px;
    padding:24px; position:relative; overflow:hidden;
  }
  .game-card::before {
    content:''; position:absolute; top:0; left:0; right:0; height:3px;
    background: linear-gradient(90deg, var(--moto), var(--cat), var(--btc));
  }
  .game-title { font-size:20px; font-weight:800; margin-bottom:4px; }
  .game-subtitle { font-size:13px; color:var(--muted); margin-bottom:20px; }
  #gameCanvas {
    display:block; width:100%; border-radius:10px;
    border: 1px solid var(--border); background:#06060e;
    cursor:pointer;
  }
  .game-controls { display:flex; gap:10px; margin-top:12px; align-items:center; flex-wrap:wrap; }
  .game-btn {
    padding:8px 20px; border-radius:8px; font-weight:700; font-size:13px;
    cursor:pointer; font-family:'Syne',sans-serif; transition:.15s; border:none;
  }
  .game-btn.start { background:var(--moto); color:#fff; }
  .game-btn.start:hover { background:#7c3aed; }
  .game-btn.reset { background:transparent; border:1px solid var(--border); color:var(--muted); }
  .game-btn.reset:hover { border-color:var(--cat); color:var(--cat); }
  .game-score {
    font-family:'Space Mono',monospace; font-size:13px;
    background:rgba(139,92,246,0.1); border:1px solid rgba(139,92,246,0.3);
    padding:6px 14px; border-radius:6px; color:var(--moto);
  }
  .game-hint { font-size:12px; color:var(--muted); margin-left:auto; }
  .game-leaderboard {
    display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;
  }
  .lb-entry {
    background:rgba(255,255,255,0.04); border:1px solid var(--border);
    border-radius:6px; padding:5px 12px; font-size:12px; font-family:'Space Mono',monospace;
  }
  .lb-entry .rank { color:var(--btc); margin-right:4px; }
  .lb-entry .lbscore { color:var(--cat); }

  /* ‚îÄ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ */
  footer {
    border-top:1px solid var(--border); padding:24px;
    display:flex; gap:16px; align-items:center; flex-wrap:wrap;
    max-width:1200px; margin:0 auto;
  }
  footer .logo { font-size:14px; }
  footer p { font-size:12px; color:var(--muted); }
  footer .footer-links { display:flex; gap:16px; margin-left:auto; flex-wrap:wrap; }
  footer .footer-links a { font-size:12px; color:var(--muted); text-decoration:none; }
  footer .footer-links a:hover { color:var(--btc); }

  /* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
  @media (max-width:768px) {
    .hero { grid-template-columns:1fr; gap:24px; }
    .tools-grid { grid-template-columns:1fr; }
    .stats-grid { grid-template-columns:1fr 1fr; }
    .topbar-links { display:none; }
  }
</style>
</head>
<body>

<!-- TOP BAR -->
<header class="topbar">
  <div class="logo">OP<span>_</span>NET</div>
  <div class="price-pill" id="topPrice">
    ‚Çø <span id="topPriceVal">‚Äî</span>
    <span class="change" id="topPriceChange">‚Äî</span>
  </div>
  <div class="price-pill" style="border-color:rgba(139,92,246,0.3); background:rgba(139,92,246,0.08); color:#a78bfa; font-size:11px;">
    üõµ BTC L1 DeFi
  </div>
  <nav class="topbar-links">
    <a href="#chart" class="active">Chart</a>
    <a href="#ecosystem">Ecosystem</a>
    <a href="#copilot">Copilot</a>
    <a href="#game">Game</a>
  </nav>
  <button class="connect-btn" onclick="alert('Connect OP_WALLET to interact with DeFi!')">Connect Wallet</button>
</header>

<div class="page">

  <!-- HERO -->
  <div class="hero">
    <div class="hero-left">
      <h1>Bitcoin<br><em>DeFi Hub</em><br>& Copilot</h1>
      <p>The complete dashboard for OP_NET ‚Äî Bitcoin Layer 1 smart contracts. Analyze wallets, track BTC live, explore the ecosystem, and play the MotoCat racer.</p>
      <div class="hero-actions">
        <a href="#chart" class="btn-primary">Live BTC Chart ‚Üì</a>
        <a href="#game" class="btn-ghost">üê± Play MotoCat Race</a>
      </div>
    </div>
    <div class="hero-right">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">BTC Price</div>
          <div class="stat-val" id="heroPrice">‚Äî</div>
          <div class="stat-sub" id="heroPriceSub">Loading...</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Network</div>
          <div class="stat-val" style="font-size:14px; color:var(--green);">‚óè LIVE</div>
          <div class="stat-sub">OP_NET Mainnet</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Swaps</div>
          <div class="stat-val">325k+</div>
          <div class="stat-sub">MotoSwap testnet</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">$MOTO Staked</div>
          <div class="stat-val">296M</div>
          <div class="stat-sub">Across testnet</div>
        </div>
      </div>
    </div>
  </div>

  <!-- BTC CHART -->
  <div class="chart-section" id="chart">
    <div class="chart-card">
      <div class="chart-header">
        <div>
          <div class="chart-title">Bitcoin / USD</div>
          <div style="display:flex; gap:10px; align-items:center; margin-top:4px;">
            <span class="chart-price" id="chartPrice">Loading...</span>
            <span class="chart-change up" id="chartChange">‚Äî</span>
          </div>
        </div>
        <div class="chart-tabs" id="chartTabs">
          <button class="chart-tab" onclick="loadChart('1')">1D</button>
          <button class="chart-tab active" onclick="loadChart('7')">7D</button>
          <button class="chart-tab" onclick="loadChart('30')">1M</button>
          <button class="chart-tab" onclick="loadChart('90')">3M</button>
          <button class="chart-tab" onclick="loadChart('365')">1Y</button>
        </div>
      </div>
      <canvas id="btcChart"></canvas>
      <div class="chart-footer">
        <div class="chart-stat"><span>24h High</span><b id="high24">‚Äî</b></div>
        <div class="chart-stat"><span>24h Low</span><b id="low24">‚Äî</b></div>
        <div class="chart-stat"><span>Market Cap</span><b id="mcap">‚Äî</b></div>
        <div class="chart-stat"><span>24h Volume</span><b id="vol24">‚Äî</b></div>
        <div class="chart-stat" style="margin-left:auto; color:var(--muted); font-size:11px;">Powered by CoinGecko</div>
      </div>
    </div>
  </div>

  <!-- ECOSYSTEM -->
  <div class="section" id="ecosystem">
    <div class="section-title">üåê OP_NET Ecosystem</div>
    <div class="eco-grid">
      <a href="https://motoswap.org" target="_blank" class="eco-card">
        <div class="eco-icon">üõµ</div>
        <div class="eco-name">MotoSwap DEX</div>
        <div class="eco-desc">The first Bitcoin L1 DEX. Swap OP_20 tokens, provide liquidity, stake & farm $MOTO ‚Äî fully self-custodial.</div>
        <span class="eco-tag moto">DEX ¬∑ $MOTO</span>
      </a>
      <a href="https://garage.motoswap.org" target="_blank" class="eco-card">
        <div class="eco-icon">üê±</div>
        <div class="eco-name">MotoCats Garage</div>
        <div class="eco-desc">10,000 Bitcoin-native MotoCats. Stake your NFTs, earn real yield and ecosystem rewards on OP_NET.</div>
        <span class="eco-tag cat">NFT ¬∑ OP_721</span>
      </a>
      <a href="https://faucet.opnet.org" target="_blank" class="eco-card">
        <div class="eco-icon">üö∞</div>
        <div class="eco-name">rBTC Faucet</div>
        <div class="eco-desc">Get regtest BTC to start testing OP_NET DeFi protocols without real funds.</div>
        <span class="eco-tag">Testnet</span>
      </a>
      <a href="https://opnet.org" target="_blank" class="eco-card">
        <div class="eco-icon">üåê</div>
        <div class="eco-name">OP_NET Portal</div>
        <div class="eco-desc">Main hub for OP_NET ‚Äî earn points, track tasks, and explore the programmable Bitcoin ecosystem.</div>
        <span class="eco-tag">Portal</span>
      </a>
      <a href="https://docs.opnet.org" target="_blank" class="eco-card">
        <div class="eco-icon">üìñ</div>
        <div class="eco-name">Developer Docs</div>
        <div class="eco-desc">Build OP_20 tokens and OP_721 NFTs with AssemblyScript, Rust, or TypeScript on Bitcoin L1.</div>
        <span class="eco-tag">Dev</span>
      </a>
      <a href="https://chromewebstore.google.com/detail/opwallet/pmbjpcmaaladnfpackmhmnfmpklgbdjb" target="_blank" class="eco-card">
        <div class="eco-icon">üîê</div>
        <div class="eco-name">OP_WALLET</div>
        <div class="eco-desc">Official Bitcoin browser extension wallet for interacting with OP_NET smart contracts.</div>
        <span class="eco-tag">Wallet</span>
      </a>
      <a href="https://motoswap.org/pools" target="_blank" class="eco-card">
        <div class="eco-icon">üåä</div>
        <div class="eco-name">Liquidity Pools</div>
        <div class="eco-desc">Provide liquidity to MotoSwap pools and earn trading fees + $MOTO farming rewards via MotoChef.</div>
        <span class="eco-tag moto">DeFi ¬∑ LP</span>
      </a>
      <a href="https://opnet.org/points" target="_blank" class="eco-card">
        <div class="eco-icon">üèÜ</div>
        <div class="eco-name">Points & Airdrop</div>
        <div class="eco-desc">Complete on-chain tasks every 48h to earn points and climb the leaderboard for airdrop rewards.</div>
        <span class="eco-tag" style="background:rgba(255,215,0,0.12); color:#ffd700;">Airdrop</span>
      </a>
    </div>
  </div>

  <!-- WALLET COPILOT -->
  <div class="section" id="copilot">
    <div class="section-title">ü§ñ Wallet Copilot</div>
    <div class="tools-grid">
      <div class="tool-card">
        <div class="tc-title">üîç Address Analyzer</div>
        <div class="tc-sub">Inspect rBTC balance, OP_20 tokens & recent transactions</div>
        <div class="input-row">
          <input type="text" class="addr-input" id="analyzeAddr" placeholder="Enter rBTC / OP_NET address..." />
          <button class="analyze-btn" onclick="analyzeAddress()">Analyze ‚Üí</button>
        </div>
        <div class="result-box" id="analyzeResult">
          <span style="color:var(--muted)">Enter an address to see cryptographically verified data from OP_NET.</span>
        </div>
        <div class="ai-bubble" id="aiBubble" style="display:none">
          <div class="ai-tag">ü§ñ AI Copilot</div>
          <div id="aiText"></div>
        </div>
      </div>
      <div class="tool-card">
        <div class="tc-title">üìä DeFi Positions</div>
        <div class="tc-sub">View liquidity pools, staking, and yield estimates</div>
        <div class="input-row">
          <input type="text" class="addr-input" id="defiAddr" placeholder="Enter address to load positions..." />
          <button class="analyze-btn" onclick="loadDefi()">Load ‚Üí</button>
        </div>
        <div class="result-box" id="defiResult">
          <span style="color:var(--muted)">Enter an address to see DeFi positions on OP_NET.</span>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:8px; margin-top:12px;">
          <div style="background:rgba(255,255,255,0.04); border-radius:8px; padding:10px; text-align:center;">
            <div style="font-size:10px; color:var(--muted); margin-bottom:4px;">WALLET</div>
            <div style="font-size:15px; font-weight:700;" id="statWallet">‚Äî</div>
          </div>
          <div style="background:rgba(255,255,255,0.04); border-radius:8px; padding:10px; text-align:center;">
            <div style="font-size:10px; color:var(--muted); margin-bottom:4px;">IN DEFI</div>
            <div style="font-size:15px; font-weight:700;" id="statDefi">‚Äî</div>
          </div>
          <div style="background:rgba(255,255,255,0.04); border-radius:8px; padding:10px; text-align:center;">
            <div style="font-size:10px; color:var(--muted); margin-bottom:4px;">POSITIONS</div>
            <div style="font-size:15px; font-weight:700;" id="statPos">‚Äî</div>
          </div>
          <div style="background:rgba(255,255,255,0.04); border-radius:8px; padding:10px; text-align:center;">
            <div style="font-size:10px; color:var(--muted); margin-bottom:4px;">DAILY EST</div>
            <div style="font-size:15px; font-weight:700; color:var(--green);" id="statYield">‚Äî</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MOTOCAT RACE GAME -->
  <div class="section" id="game">
    <div class="section-title">üéÆ MotoCat Racer ‚Äî OP_NET Edition</div>
    <div class="game-card">
      <div class="game-title">üê±üõµ MotoCat Racer</div>
      <div class="game-subtitle">Race your MotoCat across Bitcoin blocks! Dodge mempool spikes & collect $MOTO. Tap / Space to jump.</div>
      <canvas id="gameCanvas" height="200"></canvas>
      <div class="game-controls">
        <button class="game-btn start" id="startBtn" onclick="startGame()">‚ñ∂ Start Race</button>
        <button class="game-btn reset" onclick="resetGame()">‚Ü© Reset</button>
        <div class="game-score">Score: <span id="scoreDisplay">0</span></div>
        <div class="game-score" style="background:rgba(244,114,182,0.1); border-color:rgba(244,114,182,0.3); color:var(--cat);">Best: <span id="bestDisplay">0</span></div>
        <div class="game-hint">SPACE / Tap = Jump &nbsp;|&nbsp; Double-jump available!</div>
      </div>
      <div class="game-leaderboard" id="leaderboard"></div>
    </div>
  </div>

</div>

<!-- FOOTER -->
<footer>
  <div class="logo">OP<span style="color:var(--btc)">_</span>NET</div>
  <p>Bitcoin Layer 1 DeFi ¬∑ Powered by OP_NET & MotoSwap</p>
  <div class="footer-links">
    <a href="https://opnet.org" target="_blank">OP_NET</a>
    <a href="https://motoswap.org" target="_blank">MotoSwap</a>
    <a href="https://garage.motoswap.org" target="_blank">MotoCats</a>
    <a href="https://docs.opnet.org" target="_blank">Docs</a>
    <a href="https://faucet.opnet.org" target="_blank">Faucet</a>
  </div>
</footer>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BTC PRICE & CHART
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let btcChart = null;
let currentDays = '7';
let priceData = {};

async function fetchBTCPrice() {
  try {
    const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true&include_market_cap=true&include_high_24h=true&include_low_24h=true');
    const d = await r.json();
    const btc = d.bitcoin;
    priceData = btc;
    const price = btc.usd.toLocaleString('en-US', {style:'currency',currency:'USD',maximumFractionDigits:0});
    const change = btc.usd_24h_change.toFixed(2);
    const up = btc.usd_24h_change >= 0;

    document.getElementById('topPriceVal').textContent = price;
    document.getElementById('topPriceChange').textContent = (up?'+':'')+change+'%';
    document.getElementById('topPriceChange').className = 'change ' + (up?'up':'down');

    document.getElementById('chartPrice').textContent = price;
    document.getElementById('chartChange').textContent = (up?'‚ñ≤':'‚ñº')+' '+(up?'+':'')+change+'%';
    document.getElementById('chartChange').className = 'chart-change ' + (up?'up':'down');

    document.getElementById('heroPrice').textContent = '$'+Math.round(btc.usd/1000)+'k';
    document.getElementById('heroPriceSub').textContent = (up?'+':'')+change+'% 24h';

    document.getElementById('high24').textContent = '$'+btc.usd_high_24h?.toLocaleString('en-US',{maximumFractionDigits:0}) || '‚Äî';
    document.getElementById('low24').textContent = '$'+btc.usd_low_24h?.toLocaleString('en-US',{maximumFractionDigits:0}) || '‚Äî';
    document.getElementById('mcap').textContent = '$'+(btc.usd_market_cap/1e12).toFixed(2)+'T';
    document.getElementById('vol24').textContent = '$'+(btc.usd_24h_vol/1e9).toFixed(1)+'B';
  } catch(e) {
    document.getElementById('chartPrice').textContent = 'API unavailable';
  }
}

async function loadChart(days) {
  currentDays = days;
  // Update tab styling
  document.querySelectorAll('.chart-tab').forEach((t,i) => {
    t.classList.toggle('active', ['1','7','30','90','365'][i] === days);
  });
  try {
    const r = await fetch(`https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=${days}`);
    const d = await r.json();
    const labels = d.prices.map(p => {
      const dt = new Date(p[0]);
      if(days === '1') return dt.getHours()+':'+String(dt.getMinutes()).padStart(2,'0');
      return (dt.getMonth()+1)+'/'+(dt.getDate());
    });
    const prices = d.prices.map(p => p[1]);
    const startP = prices[0], endP = prices[prices.length-1];
    const isUp = endP >= startP;
    const color = isUp ? '#f7931a' : '#ff4d6d';

    if(btcChart) btcChart.destroy();
    const ctx = document.getElementById('btcChart').getContext('2d');
    const grad = ctx.createLinearGradient(0,0,0,280);
    grad.addColorStop(0, isUp ? 'rgba(247,147,26,0.3)' : 'rgba(255,77,109,0.3)');
    grad.addColorStop(1, 'rgba(0,0,0,0)');

    btcChart = new Chart(ctx, {
      type:'line',
      data: {
        labels: labels,
        datasets:[{
          data: prices, borderColor: color,
          backgroundColor: grad, borderWidth: 2,
          pointRadius: 0, tension: 0.3, fill:true
        }]
      },
      options: {
        responsive:true, maintainAspectRatio:true,
        interaction: { intersect:false, mode:'index' },
        plugins: { legend:{display:false}, tooltip:{
          backgroundColor:'rgba(15,15,20,0.95)',
          borderColor:'rgba(247,147,26,0.3)', borderWidth:1,
          titleColor:'#888', bodyColor:'#fff',
          callbacks:{label: ctx => '$'+ctx.parsed.y.toLocaleString('en-US',{maximumFractionDigits:0})}
        }},
        scales: {
          x: { grid:{color:'rgba(255,255,255,0.04)'}, ticks:{color:'#555', maxTicksLimit:8, font:{size:11}} },
          y: { grid:{color:'rgba(255,255,255,0.04)'}, ticks:{color:'#555', font:{size:11,family:'Space Mono'},
            callback: v => '$'+(v/1000).toFixed(0)+'k' }, position:'right' }
        }
      }
    });
  } catch(e) {
    console.error('Chart load failed',e);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WALLET COPILOT (Mock + Demo)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function analyzeAddress() {
  const addr = document.getElementById('analyzeAddr').value.trim();
  const res = document.getElementById('analyzeResult');
  const ai = document.getElementById('aiBubble');
  const aiText = document.getElementById('aiText');
  if(!addr) { res.innerHTML='<span style="color:var(--red)">Please enter an address.</span>'; return; }

  res.innerHTML='<span style="color:var(--btc)">üîç Fetching data from OP_NET...</span>';
  ai.style.display='none';

  setTimeout(() => {
    // Demo / mock response
    const isDemo = addr.toLowerCase().includes('demo') || addr.length > 20;
    if(isDemo) {
      res.innerHTML = `<span style="color:#aaa">Address:</span> <span style="color:var(--btc)">${addr.slice(0,12)}...${addr.slice(-6)}</span>\n\n` +
        `<span style="color:#aaa">rBTC Balance:</span> <span style="color:#fff">0.00042 rBTC</span>\n` +
        `<span style="color:#aaa">OP_20 Tokens:</span>\n` +
        `  ¬∑ MOTO  <span style="color:var(--moto)">1,200.00</span>\n` +
        `  ¬∑ PILL  <span style="color:var(--cat)">300.50</span>\n\n` +
        `<span style="color:#aaa">Transactions (last 5):</span> 5 on OP_NET\n` +
        `  ‚úì Swap MOTO‚ÜírBTC  <span style="color:var(--green)">confirmed</span>\n` +
        `  ‚úì Add LP  <span style="color:var(--green)">confirmed</span>\n` +
        `  ‚úì Stake MOTO  <span style="color:var(--green)">confirmed</span>`;
      ai.style.display='block';
      aiText.innerHTML = `This wallet is <b>active in the MotoSwap ecosystem</b> üõµ ‚Äî holding both MOTO and PILL tokens. The LP position suggests they're farming yield. Consider checking the <a href="https://motoswap.org" style="color:var(--btc)">MotoSwap pools page</a> for current APY rates.`;
    } else {
      res.innerHTML = `<span style="color:var(--muted)">‚ö†Ô∏è This looks like a demo address. In production, this connects to the OP_NET API.\n\nTry typing <b>demo</b> or any longer address for a sample analysis.</span>`;
    }
  }, 1200);
}

function loadDefi() {
  const addr = document.getElementById('defiAddr').value.trim();
  const res = document.getElementById('defiResult');
  if(!addr) { res.innerHTML='<span style="color:var(--red)">Please enter an address.</span>'; return; }
  res.innerHTML='<span style="color:var(--btc)">üìä Loading DeFi positions...</span>';
  setTimeout(() => {
    if(addr.length > 5) {
      res.innerHTML = `<b>MotoSwap LP</b>  MOTO/rBTC Pool\n  ¬∑ Deposited: <span style="color:var(--green)">$420 USD</span>  APY: <span style="color:var(--btc)">38.2%</span>\n\n<b>MotoChef Farm</b>  PILL-MOTO LP\n  ¬∑ Staked: <span style="color:var(--green)">$180 USD</span>  Est. daily: <span style="color:var(--green)">+0.42 MOTO</span>\n\n<b>MotoCat Staking</b>\n  ¬∑ 1 NFT staked  Earning: <span style="color:var(--cat)">real yield</span>`;
      document.getElementById('statWallet').textContent='$240';
      document.getElementById('statDefi').textContent='$600';
      document.getElementById('statPos').textContent='3';
      document.getElementById('statYield').textContent='+$2.1/d';
    }
  }, 1000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOTOCAT RACING GAME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const canvas = document.getElementById('gameCanvas');
const ctx2 = canvas.getContext('2d');
let gameState = 'idle'; // idle | playing | dead
let score = 0, bestScore = parseInt(localStorage.getItem('motocatBest')||'0');
let raf = null;
let frameCount = 0;
let speed = 4;
let leaderboard = JSON.parse(localStorage.getItem('motocatLB')||'[]');

// Cat physics
let cat = { x:80, y:0, vy:0, jumps:0, maxJumps:2 };
let groundY = 0;
const CAT_W = 38, CAT_H = 38;

// Obstacles
let obstacles = [];
// Collectibles
let motos = [];
// BG
let blocks = [];
let bgOffset = 0;
let blockHeight = 0;

function resizeCanvas() {
  canvas.width = canvas.offsetWidth;
  canvas.height = 200;
  groundY = canvas.height - 60;
  cat.y = groundY - CAT_H;
  blockHeight = canvas.height;
}

function initGame() {
  resizeCanvas();
  cat = { x:80, y:groundY - CAT_H, vy:0, jumps:0 };
  obstacles = [];
  motos = [];
  bgOffset = 0;
  score = 0;
  frameCount = 0;
  speed = 4;
  blocks = Array.from({length:8}, (_,i)=>({x:i*(canvas.width/7), w:80+Math.random()*60, h:20+Math.random()*40, col:Math.random()<0.5?'#1a1a2e':'#0f0f1a'}));
  document.getElementById('scoreDisplay').textContent = '0';
  document.getElementById('bestDisplay').textContent = bestScore;
}

function jump() {
  if(gameState === 'idle' || gameState === 'dead') { startGame(); return; }
  if(cat.jumps < 2) {
    cat.vy = cat.jumps === 0 ? -13 : -10;
    cat.jumps++;
  }
}

function startGame() {
  if(gameState === 'playing') return;
  initGame();
  gameState = 'playing';
  document.getElementById('startBtn').textContent = '‚è∏ Running...';
  gameLoop();
}

function resetGame() {
  cancelAnimationFrame(raf);
  gameState = 'idle';
  initGame();
  document.getElementById('startBtn').textContent = '‚ñ∂ Start Race';
  drawIdle();
}

function spawnObstacle() {
  const type = Math.random();
  const h = type < 0.5 ? 30+Math.random()*30 : 50+Math.random()*20;
  const w = 18+Math.random()*14;
  obstacles.push({
    x: canvas.width + 20,
    y: groundY - h,
    w, h,
    type: type < 0.3 ? 'spike' : type < 0.7 ? 'block' : 'tall'
  });
}

function spawnMoto() {
  motos.push({ x: canvas.width+10, y: groundY - 40 - Math.random()*60, r:10 });
}

function gameLoop() {
  raf = requestAnimationFrame(gameLoop);
  frameCount++;
  speed = 4 + Math.floor(frameCount/400)*0.5;
  score = Math.floor(frameCount/6);
  document.getElementById('scoreDisplay').textContent = score;

  // Spawn
  if(frameCount % Math.max(60, 120-Math.floor(frameCount/300)*5) === 0) spawnObstacle();
  if(frameCount % 180 === 0) spawnMoto();

  // Physics
  cat.vy += 0.7;
  cat.y += cat.vy;
  if(cat.y >= groundY - CAT_H) {
    cat.y = groundY - CAT_H;
    cat.vy = 0;
    cat.jumps = 0;
  }

  // BG
  bgOffset = (bgOffset + speed*0.3) % canvas.width;
  blocks.forEach(b => { b.x -= speed*0.25; if(b.x+b.w < 0) { b.x = canvas.width; b.w=80+Math.random()*60; b.h=20+Math.random()*40; } });

  // Obstacles
  obstacles.forEach(o => o.x -= speed);
  obstacles = obstacles.filter(o => o.x + o.w > -20);

  // Motos
  motos.forEach(m => m.x -= speed);
  motos = motos.filter(m => {
    const collected = m.x < cat.x+CAT_W && m.x+20 > cat.x && m.y < cat.y+CAT_H && m.y+20 > cat.y;
    if(collected) { score += 10; frameCount += 60; } // bonus
    return m.x > -20 && !collected;
  });

  // Collision
  for(const o of obstacles) {
    const pad = 6;
    if(cat.x+CAT_W-pad > o.x+pad && cat.x+pad < o.x+o.w-pad &&
       cat.y+CAT_H-pad > o.y+pad && cat.y+pad < o.y+o.h-pad) {
      endGame(); return;
    }
  }

  // Draw
  drawGame();
}

function drawGame() {
  const w = canvas.width, h = canvas.height;
  // BG
  ctx2.fillStyle = '#060610';
  ctx2.fillRect(0,0,w,h);

  // BG blocks (Bitcoin chain blocks)
  blocks.forEach(b => {
    ctx2.fillStyle = b.col;
    ctx2.fillRect(b.x, h-b.h-40, b.w, b.h);
    ctx2.strokeStyle='rgba(247,147,26,0.08)';
    ctx2.strokeRect(b.x, h-b.h-40, b.w, b.h);
    // Hash label
    ctx2.fillStyle='rgba(247,147,26,0.15)';
    ctx2.font='8px Space Mono';
    ctx2.fillText('BLK', b.x+6, h-b.h-44);
  });

  // Ground
  ctx2.fillStyle = '#1a1a2e';
  ctx2.fillRect(0, groundY, w, h-groundY);
  ctx2.strokeStyle='rgba(247,147,26,0.3)';
  ctx2.beginPath(); ctx2.moveTo(0,groundY); ctx2.lineTo(w,groundY); ctx2.stroke();

  // Ground grid
  ctx2.strokeStyle='rgba(247,147,26,0.06)';
  for(let x=0; x<w; x+=40) {
    ctx2.beginPath(); ctx2.moveTo((x-bgOffset%40+40)%40, groundY); ctx2.lineTo((x-bgOffset%40+40)%40, h); ctx2.stroke();
  }

  // Score HUD
  ctx2.fillStyle='rgba(247,147,26,0.8)';
  ctx2.font='bold 13px Syne, sans-serif';
  ctx2.fillText('üõµ '+score+' pts', 12, 22);
  ctx2.fillStyle='rgba(255,255,255,0.3)';
  ctx2.fillText('Best: '+bestScore, 12, 38);
  // Speed bar
  const spd = Math.min((speed-4)/4, 1);
  ctx2.fillStyle='rgba(139,92,246,0.3)';
  ctx2.fillRect(w-100, 10, 90, 8);
  ctx2.fillStyle='#8b5cf6';
  ctx2.fillRect(w-100, 10, 90*spd, 8);
  ctx2.fillStyle='rgba(255,255,255,0.4)'; ctx2.font='9px Space Mono';
  ctx2.fillText('SPEED', w-100, 30);

  // $MOTO coins
  motos.forEach(m => {
    ctx2.save();
    ctx2.shadowColor='#8b5cf6'; ctx2.shadowBlur=8;
    ctx2.fillStyle='#a78bfa';
    ctx2.beginPath(); ctx2.arc(m.x+10, m.y+10, 10, 0, Math.PI*2); ctx2.fill();
    ctx2.fillStyle='#fff'; ctx2.font='bold 9px Syne';
    ctx2.textAlign='center'; ctx2.fillText('M', m.x+10, m.y+14);
    ctx2.textAlign='left'; ctx2.restore();
  });

  // Obstacles
  obstacles.forEach(o => {
    if(o.type === 'spike') {
      // mempool spike
      ctx2.fillStyle='#ff4d6d';
      ctx2.beginPath();
      ctx2.moveTo(o.x, o.y+o.h);
      ctx2.lineTo(o.x+o.w/2, o.y);
      ctx2.lineTo(o.x+o.w, o.y+o.h);
      ctx2.closePath(); ctx2.fill();
      ctx2.fillStyle='rgba(255,77,109,0.2)';
      ctx2.fillRect(o.x-2, o.y+o.h-2, o.w+4, 4);
      // label
      ctx2.fillStyle='rgba(255,77,109,0.7)'; ctx2.font='8px Space Mono';
      ctx2.fillText('MEMPOOL', o.x-4, o.y-4);
    } else if(o.type === 'tall') {
      // wall
      const grad = ctx2.createLinearGradient(o.x,0,o.x+o.w,0);
      grad.addColorStop(0,'#f7931a'); grad.addColorStop(1,'rgba(247,147,26,0.3)');
      ctx2.fillStyle=grad;
      ctx2.fillRect(o.x, o.y, o.w, o.h);
      ctx2.fillStyle='rgba(0,0,0,0.4)'; ctx2.font='8px Space Mono';
      ctx2.fillText('FEE', o.x+3, o.y+14);
    } else {
      ctx2.fillStyle='#1e40af';
      ctx2.fillRect(o.x, o.y, o.w, o.h);
      ctx2.strokeStyle='rgba(59,130,246,0.5)'; ctx2.strokeRect(o.x, o.y, o.w, o.h);
      ctx2.fillStyle='rgba(255,255,255,0.3)'; ctx2.font='8px Space Mono';
      ctx2.fillText('OP_20', o.x+2, o.y+12);
    }
  });

  // Cat
  drawCat(cat.x, cat.y, CAT_W, CAT_H, gameState==='dead');
}

function drawCat(x, y, w, h, dead=false) {
  ctx2.save();
  if(dead) { ctx2.globalAlpha=0.6; ctx2.translate(x+w/2, y+h/2); ctx2.rotate(0.4); x=-w/2; y=-h/2; }
  // Body
  ctx2.fillStyle = dead ? '#666' : '#f472b6';
  ctx2.beginPath();
  ctx2.roundRect(x, y, w, h, 8);
  ctx2.fill();
  // Helmet
  ctx2.fillStyle = dead ? '#555' : '#f7931a';
  ctx2.beginPath();
  ctx2.roundRect(x+4, y+2, w-8, h*0.45, 6);
  ctx2.fill();
  // Visor
  ctx2.fillStyle = dead ? '#333' : '#60a5fa';
  ctx2.beginPath();
  ctx2.roundRect(x+8, y+7, w-16, h*0.2, 3);
  ctx2.fill();
  // Eyes
  ctx2.fillStyle = dead ? '#999' : '#fff';
  ctx2.fillRect(x+8, y+h*0.5, 5, 5);
  ctx2.fillRect(x+w-13, y+h*0.5, 5, 5);
  ctx2.fillStyle = dead ? '#fff' : '#111';
  ctx2.fillRect(x+10, y+h*0.5+1, 2, 3);
  ctx2.fillRect(x+w-11, y+h*0.5+1, 2, 3);
  // Ears
  ctx2.fillStyle = dead ? '#666' : '#f472b6';
  ctx2.beginPath();
  ctx2.moveTo(x+4,y+2); ctx2.lineTo(x-2,y-8); ctx2.lineTo(x+10,y+2); ctx2.closePath(); ctx2.fill();
  ctx2.beginPath();
  ctx2.moveTo(x+w-4,y+2); ctx2.lineTo(x+w+2,y-8); ctx2.lineTo(x+w-10,y+2); ctx2.closePath(); ctx2.fill();
  // Moto
  ctx2.fillStyle = dead ? '#555' : '#fbbf24';
  ctx2.fillRect(x+4, y+h-10, w-8, 8);
  // Wheels
  ctx2.fillStyle=dead?'#444':'#374151';
  ctx2.beginPath(); ctx2.arc(x+12, y+h, 8,0,Math.PI*2); ctx2.fill();
  ctx2.beginPath(); ctx2.arc(x+w-12, y+h, 8,0,Math.PI*2); ctx2.fill();
  ctx2.fillStyle=dead?'#555':'#9ca3af';
  ctx2.beginPath(); ctx2.arc(x+12, y+h, 4,0,Math.PI*2); ctx2.fill();
  ctx2.beginPath(); ctx2.arc(x+w-12, y+h, 4,0,Math.PI*2); ctx2.fill();
  // exhaust
  if(!dead && frameCount%6<3) {
    ctx2.fillStyle='rgba(247,147,26,0.6)';
    ctx2.beginPath(); ctx2.arc(x-8, y+h-6, 4+Math.random()*4,0,Math.PI*2); ctx2.fill();
  }
  ctx2.restore();
}

function drawIdle() {
  const w = canvas.width, h = canvas.height;
  ctx2.fillStyle='#060610'; ctx2.fillRect(0,0,w,h);
  ctx2.fillStyle='#1a1a2e'; ctx2.fillRect(0,groundY,w,h-groundY);
  ctx2.strokeStyle='rgba(247,147,26,0.3)';
  ctx2.beginPath(); ctx2.moveTo(0,groundY); ctx2.lineTo(w,groundY); ctx2.stroke();
  drawCat(80, groundY-CAT_H, CAT_W, CAT_H);
  // Title
  ctx2.fillStyle='rgba(255,255,255,0.9)';
  ctx2.font='bold 22px Syne, sans-serif';
  ctx2.textAlign='center';
  ctx2.fillText('üê± MotoCat Racer', w/2, h/2-16);
  ctx2.fillStyle='rgba(247,147,26,0.7)';
  ctx2.font='13px Syne, sans-serif';
  ctx2.fillText('Press SPACE or tap to start racing!', w/2, h/2+12);
  ctx2.textAlign='left';
}

function endGame() {
  gameState = 'dead';
  cancelAnimationFrame(raf);
  if(score > bestScore) {
    bestScore = score;
    localStorage.setItem('motocatBest', bestScore);
  }
  document.getElementById('bestDisplay').textContent = bestScore;
  document.getElementById('startBtn').textContent = '‚ñ∂ Start Race';

  // Add to leaderboard
  leaderboard.push(score);
  leaderboard.sort((a,b)=>b-a);
  leaderboard = leaderboard.slice(0,5);
  localStorage.setItem('motocatLB', JSON.stringify(leaderboard));
  renderLeaderboard();

  drawDead();
}

function drawDead() {
  drawGame();
  const w=canvas.width, h=canvas.height;
  ctx2.fillStyle='rgba(0,0,0,0.65)';
  ctx2.fillRect(0,0,w,h);
  ctx2.fillStyle='#ff4d6d';
  ctx2.font='bold 28px Syne, sans-serif';
  ctx2.textAlign='center';
  ctx2.fillText('üí• REKT!', w/2, h/2-24);
  ctx2.fillStyle='#fff';
  ctx2.font='16px Syne, sans-serif';
  ctx2.fillText('Score: '+score, w/2, h/2+4);
  ctx2.fillStyle='rgba(247,147,26,0.8)';
  ctx2.font='13px Syne, sans-serif';
  ctx2.fillText('Tap or press SPACE to race again', w/2, h/2+28);
  ctx2.textAlign='left';
}

function renderLeaderboard() {
  const lb = document.getElementById('leaderboard');
  lb.innerHTML = '<span style="font-size:11px;color:var(--muted);padding:4px 0;display:block;width:100%">üèÜ Session Best:</span>' +
    leaderboard.map((s,i)=>`<div class="lb-entry"><span class="rank">#${i+1}</span><span class="lbscore">${s}</span></div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('keydown', e => { if(e.code==='Space'||e.key===' ') { e.preventDefault(); jump(); }});
canvas.addEventListener('click', jump);
canvas.addEventListener('touchstart', e => { e.preventDefault(); jump(); }, {passive:false});
window.addEventListener('resize', () => { if(gameState==='idle') { resizeCanvas(); drawIdle(); }});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
fetchBTCPrice();
setInterval(fetchBTCPrice, 60000);
loadChart('7');
resizeCanvas();
drawIdle();
renderLeaderboard();
</script>
</body>
</html>    gap: 24px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    overflow: hidden;
  }
  .ticker-item { display:flex; align-items:center; gap:6px; white-space:nowrap; flex-shrink:0; }
  .ticker-label { color:var(--muted); }
  .ticker-val { color:var(--text); font-weight:700; }
  .ticker-val.up { color:var(--green); }
  .ticker-val.dn { color:var(--red); }
  .ticker-sep { color:var(--border); }

  /* countdown */
  .countdown-wrap { display:flex; align-items:center; gap:8px; margin-left:auto; }
  .countdown-label { color:var(--muted); font-size:10px; letter-spacing:1px; }
  .countdown-units { display:flex; gap:4px; }
  .cd-unit { background:var(--orange-dim); border:1px solid rgba(247,147,26,0.2); border-radius:4px; padding:2px 6px; color:var(--orange); font-size:11px; font-weight:700; min-width:28px; text-align:center; }

  /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
  nav { display:flex; align-items:center; padding:0 24px; height:60px; border-bottom:1px solid var(--border); background:rgba(8,8,16,0.9); backdrop-filter:blur(12px); position:sticky; top:0; z-index:100; gap:0; }
  .nav-logo { display:flex; align-items:center; gap:10px; margin-right:32px; flex-shrink:0; }
  .nav-logo-icon { width:30px; height:30px; background:var(--orange); border-radius:7px; display:flex; align-items:center; justify-content:center; font-size:15px; box-shadow:0 0 14px var(--orange-glow); }
  .nav-logo-text { font-size:15px; font-weight:800; letter-spacing:-0.3px; white-space:nowrap; }
  .nav-logo-text span { color:var(--orange); }
  .nav-tabs { display:flex; gap:4px; }
  .nav-tab { padding:7px 16px; border-radius:7px; font-size:12px; font-weight:600; cursor:pointer; transition:all 0.2s; color:var(--muted); border:1px solid transparent; white-space:nowrap; }
  .nav-tab:hover { color:var(--text); }
  .nav-tab.active { background:var(--orange-dim); border-color:rgba(247,147,26,0.2); color:var(--orange); }
  .nav-right { display:flex; align-items:center; gap:10px; margin-left:auto; }

  /* network pill */
  .network-pill { font-family:'Space Mono',monospace; font-size:10px; padding:4px 10px; border-radius:16px; letter-spacing:0.5px; white-space:nowrap; }
  .network-pill.connected { background:var(--green-dim); color:var(--green); border:1px solid rgba(0,229,160,0.2); }
  .network-pill.disconnected { background:var(--red-dim); color:var(--red); border:1px solid rgba(255,77,106,0.2); }
  .network-pill.connecting { background:var(--orange-dim); color:var(--orange); border:1px solid rgba(247,147,26,0.2); }
  .network-pill::before { content:'‚óè '; animation:blink 2s infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

  /* connect wallet btn */
  .connect-btn {
    display:flex; align-items:center; gap:7px;
    background:var(--surface2);
    border:1px solid var(--border);
    border-radius:8px;
    padding:7px 14px;
    font-family:'Syne',sans-serif;
    font-size:12px;
    font-weight:700;
    cursor:pointer;
    transition:all 0.2s;
    color:var(--text);
    white-space:nowrap;
  }
  .connect-btn:hover { border-color:var(--orange); color:var(--orange); }
  .connect-btn.connected-wallet { background:var(--green-dim); border-color:rgba(0,229,160,0.3); color:var(--green); }
  .connect-btn-dot { width:7px; height:7px; border-radius:50%; background:var(--muted); flex-shrink:0; }
  .connect-btn.connected-wallet .connect-btn-dot { background:var(--green); box-shadow:0 0 6px var(--green); }

  /* ‚îÄ‚îÄ QUICK LINKS BAR ‚îÄ‚îÄ */
  .quick-links {
    display:flex; align-items:center; gap:8px;
    padding:10px 24px;
    border-bottom:1px solid var(--border);
    background:rgba(8,8,16,0.5);
    flex-wrap:wrap;
  }
  .quick-links-label { font-size:10px; color:var(--muted); letter-spacing:1.5px; text-transform:uppercase; font-weight:600; margin-right:4px; }
  .quick-link {
    display:flex; align-items:center; gap:5px;
    font-size:11px; font-weight:600;
    padding:4px 12px;
    border-radius:16px;
    border:1px solid var(--border);
    background:var(--surface);
    color:var(--muted);
    cursor:pointer;
    text-decoration:none;
    transition:all 0.15s;
    white-space:nowrap;
  }
  .quick-link:hover { border-color:var(--orange); color:var(--orange); background:var(--orange-dim); }

  /* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
  .page { display:none; padding:32px 24px; max-width:960px; margin:0 auto; }
  .page.active { display:block; animation:fadeUp 0.4s ease both; }
  @keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }

  /* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
  .input-label { font-size:10px; font-weight:600; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px; display:block; }
  .input-row { display:flex; gap:10px; margin-bottom:28px; }
  .addr-input { flex:1; background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:12px 16px; font-family:'Space Mono',monospace; font-size:12px; color:var(--text); outline:none; transition:border-color 0.2s, box-shadow 0.2s; }
  .addr-input:focus { border-color:var(--orange); box-shadow:0 0 0 3px var(--orange-dim); }
  .addr-input::placeholder { color:var(--muted); }
  .btn { background:var(--orange); color:#000; border:none; border-radius:10px; padding:12px 20px; font-family:'Syne',sans-serif; font-size:13px; font-weight:700; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s, opacity 0.15s; white-space:nowrap; }
  .btn:hover { transform:translateY(-1px); box-shadow:0 6px 20px var(--orange-glow); }
  .btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }
  .btn-ghost { background:var(--surface); color:var(--text); border:1px solid var(--border); }
  .btn-ghost:hover { border-color:var(--orange); box-shadow:none; color:var(--orange); }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card { background:var(--surface); border:1px solid var(--border); border-radius:14px; overflow:hidden; transition:border-color 0.2s; }
  .card:hover { border-color:rgba(247,147,26,0.15); }
  .card-header { display:flex; align-items:center; gap:10px; padding:16px 20px; border-bottom:1px solid var(--border); }
  .card-icon { width:26px; height:26px; background:var(--orange-dim); border-radius:7px; display:flex; align-items:center; justify-content:center; font-size:13px; }
  .card-title { font-size:13px; font-weight:700; }

  /* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
  .stats-row { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:20px; }
  .stat-card { background:var(--surface); border:1px solid var(--border); border-radius:14px; padding:20px; position:relative; overflow:hidden; transition:border-color 0.2s,transform 0.2s; }
  .stat-card:hover { border-color:rgba(247,147,26,0.2); transform:translateY(-2px); }
  .stat-card::after { content:''; position:absolute; top:0; right:0; width:60px; height:60px; background:radial-gradient(circle at top right,var(--orange-dim),transparent 70%); }
  .stat-label { font-size:10px; font-weight:600; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px; }
  .stat-val { font-family:'Space Mono',monospace; font-size:22px; font-weight:700; line-height:1; margin-bottom:5px; }
  .stat-val.orange { color:var(--orange); }
  .stat-val.green { color:var(--green); }
  .stat-sub { font-size:11px; color:var(--muted); }

  .two-col { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px; }
  .full-col { margin-bottom:12px; }

  /* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */
  .chat-msgs { padding:16px 20px; min-height:190px; max-height:250px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; }
  .msg { display:flex; gap:8px; animation:fadeUp 0.3s ease both; }
  .msg.user { flex-direction:row-reverse; }
  .msg-av { width:24px; height:24px; border-radius:6px; flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:11px; margin-top:2px; }
  .msg.bot .msg-av { background:linear-gradient(135deg,var(--orange),#e55c00); }
  .msg.user .msg-av { background:var(--surface2); border:1px solid var(--border); }
  .msg-bub { background:var(--surface2); border-radius:10px; border-top-left-radius:3px; padding:8px 12px; font-size:12px; line-height:1.65; max-width:calc(100% - 32px); }
  .msg.user .msg-bub { background:var(--orange-dim); border:1px solid rgba(247,147,26,0.12); border-radius:10px; border-top-right-radius:3px; }
  .hi { color:var(--orange); font-weight:700; }
  .ok { color:var(--green); }
  .wn { color:#fbbf24; }
  .chips { padding:0 16px 12px; display:flex; gap:6px; flex-wrap:wrap; }
  .chip { font-size:11px; padding:4px 10px; border-radius:16px; background:var(--surface2); border:1px solid var(--border); color:var(--muted); cursor:pointer; transition:all 0.15s; }
  .chip:hover { border-color:var(--orange); color:var(--orange); }
  .chat-bar { padding:12px 16px; border-top:1px solid var(--border); display:flex; gap:8px; }
  .chat-in { flex:1; background:var(--surface2); border:1px solid var(--border); border-radius:8px; padding:8px 12px; font-family:'Syne',sans-serif; font-size:12px; color:var(--text); outline:none; }
  .chat-in:focus { border-color:var(--orange); }
  .chat-in::placeholder { color:var(--muted); font-size:11px; }
  .send-btn { background:var(--orange); border:none; border-radius:8px; width:34px; height:34px; cursor:pointer; color:#000; font-size:14px; display:flex; align-items:center; justify-content:center; transition:transform 0.15s; }
  .send-btn:hover { transform:scale(1.08); }
  .typing { display:flex; align-items:center; gap:4px; padding:3px 0; }
  .typing span { width:5px; height:5px; background:var(--orange); border-radius:50%; animation:bounce 1.2s infinite; }
  .typing span:nth-child(2){animation-delay:0.2s}
  .typing span:nth-child(3){animation-delay:0.4s}
  @keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:0.4}40%{transform:translateY(-5px);opacity:1}}

  /* ‚îÄ‚îÄ LIST ROWS ‚îÄ‚îÄ */
  .list-row { display:flex; align-items:center; padding:12px 20px; gap:12px; cursor:pointer; transition:background 0.15s; border-bottom:1px solid var(--border); }
  .list-row:last-child { border-bottom:none; }
  .list-row:hover { background:var(--surface2); }
  .row-icon { width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:13px; font-weight:700; font-family:'Space Mono',monospace; flex-shrink:0; }
  .row-info { flex:1; }
  .row-name { font-size:13px; font-weight:600; margin-bottom:2px; }
  .row-sub { font-size:11px; color:var(--muted); }
  .row-right { text-align:right; }
  .row-val { font-family:'Space Mono',monospace; font-size:13px; font-weight:700; margin-bottom:2px; }
  .row-val.pos { color:var(--green); }
  .row-val.neg { color:var(--red); }
  .row-val2 { font-size:11px; color:var(--muted); }
  .empty { padding:28px; text-align:center; color:var(--muted); font-size:12px; line-height:1.8; }

  /* badges */
  .badge { font-size:10px; font-family:'Space Mono',monospace; padding:2px 7px; border-radius:4px; letter-spacing:0.5px; }
  .badge-purple { background:rgba(167,139,250,0.1); color:var(--accent); border:1px solid rgba(167,139,250,0.2); }
  .badge-green { background:var(--green-dim); color:var(--green); border:1px solid rgba(0,229,160,0.2); }
  .badge-orange { background:var(--orange-dim); color:var(--orange); border:1px solid rgba(247,147,26,0.2); }
  .badge-red { background:var(--red-dim); color:var(--red); border:1px solid rgba(255,77,106,0.2); }

  .error-bar { background:var(--red-dim); border:1px solid rgba(255,77,106,0.3); border-radius:10px; padding:10px 14px; font-size:12px; color:var(--red); margin-bottom:16px; display:none; }

  /* ‚îÄ‚îÄ DEFI DASHBOARD ‚îÄ‚îÄ */
  .defi-hero { background:linear-gradient(135deg,var(--surface) 0%,rgba(247,147,26,0.04) 100%); border:1px solid var(--border); border-radius:14px; padding:28px; margin-bottom:20px; position:relative; overflow:hidden; }
  .defi-hero::before { content:'DeFi'; position:absolute; right:-10px; top:-10px; font-family:'DM Serif Display',serif; font-size:110px; color:rgba(247,147,26,0.04); line-height:1; pointer-events:none; user-select:none; }
  .defi-hero-label { font-size:10px; font-weight:600; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px; }
  .defi-hero-total { font-family:'DM Serif Display',serif; font-size:48px; color:var(--text); line-height:1; margin-bottom:4px; }
  .defi-hero-total span { color:var(--orange); }
  .defi-hero-sub { font-size:12px; color:var(--muted); margin-bottom:20px; }
  .defi-hero-stats { display:flex; gap:28px; flex-wrap:wrap; }
  .dhs-label { font-size:10px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-bottom:4px; }
  .dhs-val { font-family:'Space Mono',monospace; font-size:16px; font-weight:700; }
  .dhs-val.green { color:var(--green); }
  .dhs-val.orange { color:var(--orange); }

  .position-card { background:var(--surface); border:1px solid var(--border); border-radius:14px; padding:22px; margin-bottom:12px; transition:border-color 0.2s,transform 0.15s; position:relative; overflow:hidden; }
  .position-card:hover { border-color:rgba(247,147,26,0.2); transform:translateY(-1px); }
  .position-card::before { content:''; position:absolute; left:0;top:0;bottom:0; width:3px; background:var(--orange); border-radius:14px 0 0 14px; }
  .pos-header { display:flex; align-items:center; gap:12px; margin-bottom:18px; }
  .pos-icon { width:38px; height:38px; border-radius:10px; background:var(--orange-dim); display:flex; align-items:center; justify-content:center; font-size:17px; }
  .pos-name { font-size:15px; font-weight:700; margin-bottom:2px; }
  .pos-sub { font-size:11px; color:var(--muted); }
  .pos-badges { display:flex; gap:6px; margin-left:auto; flex-wrap:wrap; }
  .pos-metrics { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; }
  .pm-label { font-size:10px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-bottom:5px; }
  .pm-val { font-family:'Space Mono',monospace; font-size:15px; font-weight:700; }
  .pm-val.green { color:var(--green); }
  .pm-val.orange { color:var(--orange); }
  .apy-ring { display:flex; align-items:center; gap:8px; }
  .ring-wrap { position:relative; width:42px; height:42px; }
  .ring-wrap svg { transform:rotate(-90deg); }
  .ring-bg { fill:none; stroke:var(--border); stroke-width:4; }
  .ring-fill { fill:none; stroke:var(--green); stroke-width:4; stroke-linecap:round; }
  .ring-label { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-family:'Space Mono',monospace; font-size:9px; font-weight:700; color:var(--green); }
  .il-meter { margin-top:14px; padding-top:14px; border-top:1px solid var(--border); }
  .il-label { font-size:10px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-bottom:6px; }
  .il-bar-bg { height:4px; background:var(--border); border-radius:2px; overflow:hidden; }
  .il-bar-fill { height:100%; background:linear-gradient(90deg,var(--green),#fbbf24); border-radius:2px; }
  .il-explain { font-size:11px; color:var(--muted); margin-top:5px; line-height:1.6; }

  .no-positions { text-align:center; padding:52px 20px; color:var(--muted); }
  .no-positions-icon { font-size:44px; margin-bottom:14px; opacity:0.5; }
  .no-positions-title { font-size:17px; font-weight:700; margin-bottom:7px; color:var(--text); }
  .no-positions-sub { font-size:12px; line-height:1.7; max-width:320px; margin:0 auto; }

  /* ‚îÄ‚îÄ WALLET MODAL ‚îÄ‚îÄ */
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(4px); z-index:200; display:none; align-items:center; justify-content:center; }
  .modal-overlay.open { display:flex; animation:fadeUp 0.2s ease; }
  .modal { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:28px; width:100%; max-width:380px; position:relative; }
  .modal-close { position:absolute; top:16px; right:16px; background:none; border:none; color:var(--muted); font-size:18px; cursor:pointer; transition:color 0.15s; }
  .modal-close:hover { color:var(--text); }
  .modal-title { font-size:18px; font-weight:800; margin-bottom:6px; }
  .modal-sub { font-size:12px; color:var(--muted); margin-bottom:24px; line-height:1.6; }
  .wallet-option { display:flex; align-items:center; gap:14px; padding:14px 16px; border:1px solid var(--border); border-radius:10px; cursor:pointer; transition:all 0.15s; margin-bottom:10px; }
  .wallet-option:hover { border-color:var(--orange); background:var(--orange-dim); }
  .wallet-option-icon { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; }
  .wallet-option-name { font-size:14px; font-weight:700; margin-bottom:2px; }
  .wallet-option-sub { font-size:11px; color:var(--muted); }
  .modal-note { font-size:11px; color:var(--muted); text-align:center; line-height:1.6; margin-top:16px; }
  .modal-note a { color:var(--orange); text-decoration:none; }
  .modal-note a:hover { text-decoration:underline; }

  ::-webkit-scrollbar { width:3px; }
  ::-webkit-scrollbar-track { background:transparent; }
  ::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

  @media(max-width:680px){
    .stats-row{grid-template-columns:1fr 1fr}
    .two-col{grid-template-columns:1fr}
    .pos-metrics{grid-template-columns:1fr 1fr}
    nav{padding:0 12px}
    .page{padding:20px 12px}
    .ticker-bar{gap:12px}
    .countdown-wrap{display:none}
    .defi-hero-total{font-size:34px}
  }
</style>
</head>
<body>
<div class="app">

  <!-- ‚îÄ‚îÄ TICKER BAR ‚îÄ‚îÄ -->
  <div class="ticker-bar">
    <div class="ticker-item">
      <span class="ticker-label">BTC</span>
      <span class="ticker-val" id="btcPrice">Loading...</span>
      <span class="ticker-val up" id="btcChange"></span>
    </div>
    <span class="ticker-sep">¬∑</span>
    <div class="ticker-item">
      <span class="ticker-label">NETWORK</span>
      <span class="ticker-val">OP_NET Regtest</span>
    </div>
    <span class="ticker-sep">¬∑</span>
    <div class="ticker-item">
      <span class="ticker-label">BLOCK</span>
      <span class="ticker-val" id="tickerBlock">‚Äî</span>
    </div>
    <div class="countdown-wrap">
      <span class="countdown-label">üöÄ MAINNET IN</span>
      <div class="countdown-units">
        <div class="cd-unit" id="cd-d">‚Äî</div>
        <div class="cd-unit" id="cd-h">‚Äî</div>
        <div class="cd-unit" id="cd-m">‚Äî</div>
        <div class="cd-unit" id="cd-s">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ NAV ‚îÄ‚îÄ -->
  <nav>
    <div class="nav-logo">
      <div class="nav-logo-icon">‚Çø</div>
      <div class="nav-logo-text"><span>OP_NET</span></div>
    </div>
    <div class="nav-tabs">
      <div class="nav-tab active" onclick="showPage('wallet',this)">ü§ñ Wallet Copilot</div>
      <div class="nav-tab" onclick="showPage('defi',this)">üìä DeFi Dashboard</div>
    </div>
    <div class="nav-right">
      <div class="network-pill connecting" id="networkPill">CONNECTING...</div>
      <button class="connect-btn" id="connectBtn" onclick="openWalletModal()">
        <div class="connect-btn-dot"></div>
        Connect Wallet
      </button>
    </div>
  </nav>

  <!-- ‚îÄ‚îÄ QUICK LINKS ‚îÄ‚îÄ -->
  <div class="quick-links">
    <span class="quick-links-label">Ecosystem</span>
    <a class="quick-link" href="https://faucet.opnet.org" target="_blank">üö∞ rBTC Faucet</a>
    <a class="quick-link" href="https://motoswap.org" target="_blank">üîÑ MotoSwap DEX</a>
    <a class="quick-link" href="https://opnet.org" target="_blank">üåê OP_NET Portal</a>
    <a class="quick-link" href="https://docs.opnet.org" target="_blank">üìñ Docs</a>
    <a class="quick-link" href="https://chromewebstore.google.com/detail/opwallet/pmbjpcmaaladnfpacpmhmnfmpklgbdjb" target="_blank">üîê OP_WALLET Extension</a>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- PAGE: WALLET COPILOT                          -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page active" id="page-wallet">
    <div class="error-bar" id="walletError"></div>
    <label class="input-label">Bitcoin / OP_NET Regtest Address (rBTC)</label>
    <div class="input-row">
      <input class="addr-input" id="walletAddr" placeholder="bcrt1p... (OP_NET regtest Taproot address)" onkeydown="if(event.key==='Enter')analyzeWallet()"/>
      <button class="btn" id="walletBtn" onclick="analyzeWallet()">Analyze ‚Üí</button>
      <button class="btn btn-ghost" onclick="walletDemo()">Demo</button>
    </div>
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-label">rBTC Balance</div>
        <div class="stat-val orange" id="w-btc">‚Äî</div>
        <div class="stat-sub" id="w-btc-sub">Enter an address above</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">OP_20 Tokens</div>
        <div class="stat-val green" id="w-tokens">‚Äî</div>
        <div class="stat-sub">Active positions</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Transactions</div>
        <div class="stat-val" id="w-txs">‚Äî</div>
        <div class="stat-sub">On OP_NET regtest</div>
      </div>
    </div>
    <div class="two-col">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">ü§ñ</div>
          <div class="card-title">AI Copilot</div>
        </div>
        <div class="chat-msgs" id="chatMsgs">
          <div class="msg bot">
            <div class="msg-av">‚Çø</div>
            <div class="msg-bub">Hey! Enter a regtest address above ‚Äî I'll analyze your rBTC balance, OP_20 tokens, and transaction history, all cryptographically verified on OP_NET. üîç</div>
          </div>
        </div>
        <div class="chips">
          <div class="chip" onclick="askQ('What is rBTC?')">üí° What is rBTC?</div>
          <div class="chip" onclick="askQ('How does OP_NET work?')">üîí How it works</div>
          <div class="chip" onclick="askQ('When does mainnet launch?')">üöÄ Mainnet launch?</div>
          <div class="chip" onclick="askQ('How do I get rBTC?')">üö∞ Get rBTC</div>
        </div>
        <div class="chat-bar">
          <input class="chat-in" id="chatIn" placeholder="Ask anything about this wallet..." onkeydown="if(event.key==='Enter')sendMsg()"/>
          <button class="send-btn" onclick="sendMsg()">‚Üí</button>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon">ü™ô</div>
          <div class="card-title">OP_20 Token Holdings</div>
        </div>
        <div id="tokenList"><div class="empty">Enter an address to see token holdings</div></div>
      </div>
    </div>
    <div class="full-col">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">‚ö°</div>
          <div class="card-title">Recent Transactions</div>
          <span class="badge badge-purple" style="margin-left:auto;">‚úì CRYPTOGRAPHIC PROOF</span>
        </div>
        <div id="txList"><div class="empty">Enter an address to see transactions</div></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- PAGE: DEFI DASHBOARD                          -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-defi">
    <div class="error-bar" id="defiError"></div>
    <label class="input-label">Bitcoin / OP_NET Regtest Address (rBTC)</label>
    <div class="input-row">
      <input class="addr-input" id="defiAddr" placeholder="bcrt1p... (OP_NET regtest Taproot address)" onkeydown="if(event.key==='Enter')analyzeDefi()"/>
      <button class="btn" id="defiBtn" onclick="analyzeDefi()">Load Positions ‚Üí</button>
      <button class="btn btn-ghost" onclick="defiDemo()">Demo</button>
    </div>
    <div class="defi-hero">
      <div class="defi-hero-label">Total Portfolio Value</div>
      <div class="defi-hero-total"><span id="d-total">$0</span> <span style="font-size:22px;color:var(--muted)">USD</span></div>
      <div class="defi-hero-sub" id="d-total-sub">Enter an address to load your DeFi positions</div>
      <div class="defi-hero-stats">
        <div><div class="dhs-label">Wallet</div><div class="dhs-val orange" id="d-wallet">‚Äî</div></div>
        <div><div class="dhs-label">In DeFi</div><div class="dhs-val green" id="d-defi">‚Äî</div></div>
        <div><div class="dhs-label">Positions</div><div class="dhs-val" id="d-count">‚Äî</div></div>
        <div><div class="dhs-label">Est. Daily Earn</div><div class="dhs-val green" id="d-daily">‚Äî</div></div>
      </div>
    </div>
    <div id="positionsList">
      <div class="no-positions">
        <div class="no-positions-icon">üìä</div>
        <div class="no-positions-title">No positions loaded</div>
        <div class="no-positions-sub">Enter a regtest address to see your DeFi positions ‚Äî liquidity pools, staking, and yield estimates on OP_NET.</div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ CONNECT WALLET MODAL ‚îÄ‚îÄ -->
  <div class="modal-overlay" id="walletModal">
    <div class="modal">
      <button class="modal-close" onclick="closeWalletModal()">‚úï</button>
      <div class="modal-title">Connect Wallet</div>
      <div class="modal-sub">Connect your OP_NET wallet to automatically load your address and interact with DeFi protocols.</div>

      <div class="wallet-option" onclick="connectOPWallet()">
        <div class="wallet-option-icon" style="background:var(--orange-dim)">‚Çø</div>
        <div>
          <div class="wallet-option-name">OP_WALLET</div>
          <div class="wallet-option-sub">Official OP_NET browser extension</div>
        </div>
        <span class="badge badge-orange" style="margin-left:auto">RECOMMENDED</span>
      </div>

      <div class="wallet-option" onclick="connectManual()">
        <div class="wallet-option-icon" style="background:var(--surface2)">‚å®Ô∏è</div>
        <div>
          <div class="wallet-option-name">Enter Address Manually</div>
          <div class="wallet-option-sub">Paste any regtest address to view</div>
        </div>
      </div>

      <div class="modal-note">
        Don't have OP_WALLET yet?
        <a href="https://chromewebstore.google.com/detail/opwallet/pmbjpcmaaladnfpacpmhmnfmpklgbdjb" target="_blank">Install the Chrome extension ‚Üí</a>
      </div>
    </div>
  </div>

</div>

<script>
const API = window.location.origin;
let walletAddress = null;
let btcPriceUSD = 98000;

// ‚îÄ‚îÄ BTC PRICE (from CoinGecko free API) ‚îÄ‚îÄ
async function fetchBTCPrice() {
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
    const data = await res.json();
    const price = data.bitcoin.usd;
    const change = data.bitcoin.usd_24h_change;
    btcPriceUSD = price;
    document.getElementById('btcPrice').textContent = `$${price.toLocaleString()}`;
    const changeEl = document.getElementById('btcChange');
    const sign = change >= 0 ? '+' : '';
    changeEl.textContent = `${sign}${change.toFixed(2)}%`;
    changeEl.className = `ticker-val ${change >= 0 ? 'up' : 'dn'}`;
  } catch {
    document.getElementById('btcPrice').textContent = '~$98,000';
  }
}
fetchBTCPrice();
setInterval(fetchBTCPrice, 60000);

// ‚îÄ‚îÄ MAINNET COUNTDOWN (March 17, 2026) ‚îÄ‚îÄ
function updateCountdown() {
  const target = new Date('2026-03-17T00:00:00Z').getTime();
  const now = Date.now();
  const diff = target - now;
  if (diff <= 0) {
    ['d','h','m','s'].forEach(u => document.getElementById(`cd-${u}`).textContent = '00');
    return;
  }
  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);
  document.getElementById('cd-d').textContent = String(d).padStart(2,'0') + 'd';
  document.getElementById('cd-h').textContent = String(h).padStart(2,'0') + 'h';
  document.getElementById('cd-m').textContent = String(m).padStart(2,'0') + 'm';
  document.getElementById('cd-s').textContent = String(s).padStart(2,'0') + 's';
}
updateCountdown();
setInterval(updateCountdown, 1000);

// ‚îÄ‚îÄ NETWORK STATUS ‚îÄ‚îÄ
async function checkStatus() {
  try {
    const data = await fetch(`${API}/api/status`).then(r => r.json());
    const pill = document.getElementById('networkPill');
    if (data.connected) {
      pill.className = 'network-pill connected';
      pill.textContent = `${data.network} ¬∑ ${data.currency} ¬∑ #${data.latestBlock}`;
      document.getElementById('tickerBlock').textContent = `#${data.latestBlock}`;
    } else {
      pill.className = 'network-pill disconnected';
      pill.textContent = `${data.network || 'REGTEST'} ¬∑ OFFLINE`;
    }
  } catch {
    document.getElementById('networkPill').className = 'network-pill disconnected';
    document.getElementById('networkPill').textContent = 'SERVER OFFLINE';
  }
}
checkStatus();
setInterval(checkStatus, 30000);

// ‚îÄ‚îÄ PAGE SWITCHING ‚îÄ‚îÄ
function showPage(name, tab) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById(`page-${name}`).classList.add('active');
  tab.classList.add('active');
  const wa = document.getElementById('walletAddr').value;
  const da = document.getElementById('defiAddr').value;
  if (name === 'defi' && wa && !da) document.getElementById('defiAddr').value = wa;
  if (name === 'wallet' && da && !wa) document.getElementById('walletAddr').value = da;
}

// ‚îÄ‚îÄ WALLET MODAL ‚îÄ‚îÄ
function openWalletModal() { document.getElementById('walletModal').classList.add('open'); }
function closeWalletModal() { document.getElementById('walletModal').classList.remove('open'); }

async function connectOPWallet() {
  // Check if OP_WALLET extension is installed
  // OP_WALLET injects window.opnet similar to how MetaMask injects window.ethereum
  if (typeof window.opnet !== 'undefined') {
    try {
      const accounts = await window.opnet.requestAccounts();
      if (accounts && accounts[0]) {
        walletAddress = accounts[0];
        setConnectedWallet(walletAddress);
        closeWalletModal();
      }
    } catch (err) {
      alert('Could not connect to OP_WALLET: ' + err.message);
    }
  } else {
    // Extension not installed ‚Äî send them to install it
    if (confirm('OP_WALLET extension not detected. Open the Chrome Web Store to install it?')) {
      window.open('https://chromewebstore.google.com/detail/opwallet/pmbjpcmaaladnfpacpmhmnfmpklgbdjb', '_blank');
    }
  }
}

function connectManual() {
  closeWalletModal();
  document.getElementById('walletAddr').focus();
}

function setConnectedWallet(address) {
  walletAddress = address;
  const btn = document.getElementById('connectBtn');
  btn.className = 'connect-btn connected-wallet';
  btn.innerHTML = `<div class="connect-btn-dot"></div>${shortAddr(address)}`;
  // Auto-populate address fields
  document.getElementById('walletAddr').value = address;
  document.getElementById('defiAddr').value = address;
  analyzeWallet();
}

// ‚îÄ‚îÄ WALLET COPILOT ‚îÄ‚îÄ
async function analyzeWallet() {
  const address = document.getElementById('walletAddr').value.trim();
  if (!address) { showErr('walletError','Please enter an address first.'); return; }
  hideErr('walletError');
  const btn = document.getElementById('walletBtn');
  btn.disabled = true; btn.textContent = 'Loading...';
  document.getElementById('w-btc').textContent = '...';
  document.getElementById('w-tokens').textContent = '...';
  document.getElementById('w-txs').textContent = '...';
  document.getElementById('tokenList').innerHTML = '<div class="empty">Loading tokens...</div>';
  document.getElementById('txList').innerHTML = '<div class="empty">Loading transactions...</div>';
  clearChat();
  addMsg('bot', `Analyzing <span class="hi">${shortAddr(address)}</span> on OP_NET Regtest...`);
  try {
    const [bal, tokens, txs] = await Promise.all([
      fetch(`${API}/api/balance/${address}`).then(r => r.json()),
      fetch(`${API}/api/tokens/${address}`).then(r => r.json()),
      fetch(`${API}/api/transactions/${address}`).then(r => r.json()),
    ]);
    const btc = parseFloat(bal.balanceBTC || 0);
    const usdVal = (btc * btcPriceUSD).toLocaleString(undefined,{maximumFractionDigits:0});
    document.getElementById('w-btc').textContent = btc.toFixed(5);
    document.getElementById('w-btc-sub').textContent = `‚âà $${usdVal} USD`;
    document.getElementById('w-tokens').textContent = tokens.tokens?.length ?? 0;
    document.getElementById('w-txs').textContent = txs.transactions?.length ?? 0;
    renderTokens(tokens.tokens || []);
    renderTxs(txs.transactions || []);
    if (bal.fallback || txs.fallback) {
      addMsg('bot', `Connected to OP_NET but this address has no regtest activity yet. <span class="wn">Try the Demo button, or visit the <a href="https://faucet.opnet.org" target="_blank" style="color:var(--orange)">rBTC Faucet</a> to fund this address.</span>`);
    } else {
      addMsg('bot', `Loaded! <span class="hi">${btc.toFixed(5)} rBTC</span> (~$${usdVal}), ${tokens.tokens?.length ?? 0} OP_20 tokens, ${txs.transactions?.length ?? 0} transactions ‚Äî <span class="ok">‚úì cryptographically verified on OP_NET</span>. What would you like to know?`);
    }
  } catch (err) {
    showErr('walletError', `Server error: ${err.message}`);
  }
  btn.disabled = false; btn.textContent = 'Analyze ‚Üí';
}

function walletDemo() {
  document.getElementById('walletAddr').value = 'bcrt1plz0svv3wl05qrrv0dx8hvh5mgqc7jf3mhqgtw8jnj3l3d3cs6lzsfc3mxh';
  analyzeWallet();
}

function renderTokens(tokens) {
  const el = document.getElementById('tokenList');
  if (!tokens.length) { el.innerHTML = '<div class="empty">No OP_20 tokens found for this address</div>'; return; }
  el.innerHTML = tokens.map(t => `
    <div class="list-row">
      <div class="row-icon" style="background:${t.color||'#f7931a'}18;color:${t.color||'#f7931a'}">${t.symbol?.[0]}</div>
      <div class="row-info"><div class="row-name">${t.name}</div><div class="row-sub">OP_20 ¬∑ ${t.symbol}</div></div>
      <div class="row-right"><div class="row-val">${Number(t.balance).toLocaleString()}</div><div class="row-val2">${t.symbol}</div></div>
    </div>`).join('');
}

function renderTxs(txs) {
  const el = document.getElementById('txList');
  if (!txs.length) { el.innerHTML = '<div class="empty">No transactions found on OP_NET regtest</div>'; return; }
  const icons = {contract:'üîó',receive:'‚Üì',send:'‚Üë'};
  const titles = {contract:'Smart Contract Call (OP_NET)',receive:'Received rBTC',send:'Sent rBTC'};
  el.innerHTML = txs.map(tx => {
    const amtClass = tx.type === 'receive' ? 'pos' : 'neg';
    const prefix = tx.type === 'receive' ? '+' : '-';
    const time = tx.timestamp ? new Date(tx.timestamp*1000).toLocaleDateString() : 'Recent';
    return `
      <div class="list-row">
        <div class="row-icon" style="background:${tx.type==='receive'?'var(--green-dim)':tx.type==='contract'?'rgba(167,139,250,0.1)':'var(--red-dim)'}">
          ${icons[tx.type]||'‚Üí'}
        </div>
        <div class="row-info"><div class="row-name">${titles[tx.type]||'Transaction'}</div><div class="row-sub">${shortTxid(tx.txid)}</div></div>
        <div class="row-right"><div class="row-val ${amtClass}">${prefix}${tx.amount} rBTC</div><div class="row-val2">${time}</div></div>
      </div>`;
  }).join('');
}

// ‚îÄ‚îÄ DEFI DASHBOARD ‚îÄ‚îÄ
async function analyzeDefi() {
  const address = document.getElementById('defiAddr').value.trim();
  if (!address) { showErr('defiError','Please enter an address first.'); return; }
  hideErr('defiError');
  const btn = document.getElementById('defiBtn');
  btn.disabled = true; btn.textContent = 'Loading...';
  ['d-total','d-wallet','d-defi','d-count','d-daily'].forEach(id => document.getElementById(id).textContent = '...');
  document.getElementById('positionsList').innerHTML = '<div class="no-positions"><div class="no-positions-icon">‚è≥</div><div class="no-positions-title">Loading positions...</div></div>';
  try {
    const [portfolio, defi] = await Promise.all([
      fetch(`${API}/api/portfolio/${address}`).then(r => r.json()),
      fetch(`${API}/api/defi/${address}`).then(r => r.json()),
    ]);
    const totalUSD = parseFloat(portfolio.totalValueUSD || 0);
    const walletUSD = parseFloat(portfolio.walletValueUSD || 0);
    const defiUSD = parseFloat(portfolio.defiValueUSD || 0);
    const positions = defi.positions || [];
    const dailyEarn = positions.reduce((s,p) => s + parseFloat(p.earnings24h||0), 0);
    document.getElementById('d-total').textContent = `$${totalUSD.toLocaleString(undefined,{maximumFractionDigits:2})}`;
    document.getElementById('d-total-sub').textContent = `${portfolio.currency||'rBTC'} wallet + ${positions.length} DeFi position${positions.length!==1?'s':''} on OP_NET`;
    document.getElementById('d-wallet').textContent = `$${walletUSD.toLocaleString(undefined,{maximumFractionDigits:0})}`;
    document.getElementById('d-defi').textContent = `$${defiUSD.toLocaleString(undefined,{maximumFractionDigits:0})}`;
    document.getElementById('d-count').textContent = positions.length;
    document.getElementById('d-daily').textContent = `$${dailyEarn.toFixed(2)}`;
    renderPositions(positions);
  } catch (err) {
    showErr('defiError', `Could not load positions: ${err.message}`);
    document.getElementById('positionsList').innerHTML = '<div class="no-positions"><div class="no-positions-icon">‚ùå</div><div class="no-positions-title">Could not connect</div><div class="no-positions-sub">Make sure the server is running with npm start</div></div>';
  }
  btn.disabled = false; btn.textContent = 'Load Positions ‚Üí';
}

function defiDemo() {
  document.getElementById('defiAddr').value = 'bcrt1plz0svv3wl05qrrv0dx8hvh5mgqc7jf3mhqgtw8jnj3l3d3cs6lzsfc3mxh';
  analyzeDefi();
}

function renderPositions(positions) {
  const el = document.getElementById('positionsList');
  if (!positions.length) {
    el.innerHTML = `<div class="no-positions"><div class="no-positions-icon">üå±</div><div class="no-positions-title">No DeFi positions found</div><div class="no-positions-sub">This address hasn't provided liquidity on OP_NET yet. Visit <a href="https://motoswap.org" target="_blank" style="color:var(--orange)">MotoSwap</a> to get started!</div></div>`;
    return;
  }
  el.innerHTML = positions.map(pos => {
    const apy = parseFloat(pos.apy);
    const circ = 2 * Math.PI * 17;
    const offset = circ - (Math.min(apy,100)/100) * circ;
    const riskBadge = pos.risk==='Low'?'badge-green':pos.risk==='Medium'?'badge-orange':'badge-red';
    const ilPct = Math.min(apy*0.3, 30);
    return `
      <div class="position-card">
        <div class="pos-header">
          <div class="pos-icon">üîÑ</div>
          <div><div class="pos-name">${pos.protocol}</div><div class="pos-sub">${pos.type} ¬∑ ${pos.pair}</div></div>
          <div class="pos-badges">
            <span class="badge ${riskBadge}">${pos.risk} Risk</span>
            <span class="badge badge-purple">OP_NET</span>
          </div>
        </div>
        <div class="pos-metrics">
          <div><div class="pm-label">Position Value</div><div class="pm-val orange">$${parseFloat(pos.valueUSD).toLocaleString(undefined,{maximumFractionDigits:2})}</div></div>
          <div><div class="pm-label">Est. Daily Earn</div><div class="pm-val green">+$${pos.earnings24h}</div></div>
          <div><div class="pm-label">LP Tokens</div><div class="pm-val">${parseFloat(pos.lpBalance).toFixed(4)}</div></div>
          <div><div class="pm-label">APY</div>
            <div class="apy-ring">
              <div class="ring-wrap">
                <svg width="42" height="42" viewBox="0 0 42 42">
                  <circle class="ring-bg" cx="21" cy="21" r="17"/>
                  <circle class="ring-fill" cx="21" cy="21" r="17" stroke-dasharray="${circ}" stroke-dashoffset="${offset}"/>
                </svg>
                <div class="ring-label">${apy}%</div>
              </div>
            </div>
          </div>
        </div>
        <div class="il-meter">
          <div class="il-label">Impermanent Loss Risk</div>
          <div class="il-bar-bg"><div class="il-bar-fill" style="width:${ilPct}%"></div></div>
          <div class="il-explain">At ${apy}% APY your yield should outpace typical impermanent loss. <span style="color:var(--green)">Currently low risk.</span></div>
        </div>
      </div>`;
  }).join('');
}

// ‚îÄ‚îÄ COPILOT CHAT ‚îÄ‚îÄ
const QA = {
  'What is rBTC?': `rBTC is <span class="hi">Regtest Bitcoin</span> ‚Äî test BTC used on OP_NET's regtest network, the final pre-mainnet environment.\n\nIt has no real monetary value, but it behaves exactly like real BTC. When OP_NET launches on Bitcoin mainnet on <span class="hi">March 17, 2026</span>, this becomes real BTC automatically.`,
  'How does OP_NET work?': `OP_NET uses <span class="hi">cryptographic proof of correct execution</span>. Every node independently recalculates smart contract results from Bitcoin's raw data.\n\nUnlike BRC-20 or Runes where indexers can disagree, <span class="ok">OP_NET forces mathematical consensus</span> ‚Äî two nodes that disagree means a bug, not a feature. It's the first time Bitcoin has had truly trustless smart contracts.`,
  'When does mainnet launch?': `OP_NET launches on Bitcoin mainnet on <span class="hi">March 17, 2026</span>!\n\nThis app is already ready. One line change in the server switches from rBTC to real BTC. <span class="ok">Your competition entry will be live-ready the day mainnet launches. üöÄ</span>`,
  'How do I get rBTC?': `Easy! Visit the <span class="hi">rBTC Faucet</span> at faucet.opnet.org ‚Äî paste your regtest address and you'll receive free test rBTC in seconds.\n\nYou can also use the quick link in the Ecosystem bar at the top of this page. ‚òùÔ∏è`,
};
const fallbacks = [
  `Great question! OP_NET's regtest environment mirrors mainnet conditions ‚Äî what you test here is exactly what will run on Bitcoin mainnet on March 17.`,
  `This wallet's data is fetched directly from OP_NET nodes and verified cryptographically. No indexer can dispute or alter these results.`,
  `You can use the rBTC Faucet at faucet.opnet.org to get test funds, then try MotoSwap to make your first trade on Bitcoin Layer 1!`,
];
let fbIdx = 0;
function clearChat() { document.getElementById('chatMsgs').innerHTML = ''; }
function addMsg(role, text) {
  const c = document.getElementById('chatMsgs');
  const d = document.createElement('div');
  d.className = `msg ${role}`;
  d.innerHTML = `<div class="msg-av">${role==='bot'?'‚Çø':'üë§'}</div><div class="msg-bub">${text.replace(/\n/g,'<br>')}</div>`;
  c.appendChild(d); c.scrollTop = c.scrollHeight;
}
function showTyping() {
  const c = document.getElementById('chatMsgs');
  const d = document.createElement('div');
  d.id = 'typing'; d.className = 'msg bot';
  d.innerHTML = `<div class="msg-av">‚Çø</div><div class="msg-bub"><div class="typing"><span></span><span></span><span></span></div></div>`;
  c.appendChild(d); c.scrollTop = c.scrollHeight;
}
function hideTyping() { document.getElementById('typing')?.remove(); }
function askQ(q) {
  addMsg('user', q); showTyping();
  setTimeout(() => { hideTyping(); addMsg('bot', QA[q] || fallbacks[fbIdx++ % fallbacks.length]); }, 700 + Math.random()*300);
}
function sendMsg() {
  const inp = document.getElementById('chatIn');
  const val = inp.value.trim();
  if (!val) return;
  inp.value = ''; askQ(val);
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
function shortAddr(a) { return a.slice(0,8)+'...'+a.slice(-6); }
function shortTxid(t) { return t ? t.slice(0,10)+'...'+t.slice(-6) : '‚Äî'; }
function showErr(id, msg) { const e=document.getElementById(id); e.textContent='‚ö† '+msg; e.style.display='block'; }
function hideErr(id) { document.getElementById(id).style.display='none'; }

// Close modal on overlay click
document.getElementById('walletModal').addEventListener('click', function(e) {
  if (e.target === this) closeWalletModal();
});
</script>
</body>
</html>
